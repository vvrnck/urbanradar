# Urban Map UI

## About the project

The project uses the Vue.js framework, aiming interface componentization - in this way is possible to streamline development, just reusing the code already created -, still in the UX/UI topic, another framework used is vuetify (which already provides built in components). For the map, the project library used is leaflet - extremely focused on performance and usability. Finally, and not least, to manage application states, Vuex is the choice.

> This Project also have a mobile version that works independently. Refer to ```README.md``` of app directory for futher information.

Below are the links for further details:

- [Vue.js](https://vuejs.org/)
- [Vuetify](https://vuetifyjs.com/en/)
- [Leaflet](https://leafletjs.com/)
- [Vue2Leaflet](https://vue2-leaflet.netlify.app/)
- [Vuex](https://vuex.vuejs.org/)


## Pre Requisites

* node >=14.10.0 or <= 16.16.0
* npm or yarn
* aws cli (for s3 deploy)
* docker (for docker deploy)


## Project setup

```
yarn install
```

### Compiles and hot-reloads for development
```
yarn dev
```

### Compiles and minifies for production
```
yarn build
```

### Lints and fixes files
```
yarn lint
```

### Serve and run

```
yarn start
```

### Serve (needs build)
```
yarn serve
```

### Generate custom credentials
```
yarn account
```

## Start development

### .env

Configure a ```.env``` file for app folder:
```
VUE_APP_NODE_ENV=
VUE_APP_BASE_URL=
VUE_APP_API_URL_DEV=
VUE_APP_API_URL_HMG=
VUE_APP_API_URL_DEMO=
VUE_APP_API_URL_PRD=
VUE_APP_API_URL_TEST=
VUE_APP_TENANT=
VUE_APP_VERSION=
VUE_APP_DEFAULT_LOCALE=
VUE_APP_AWS_IDENTITY_POOL_ID=
VUE_APP_AWS_BUCKET_REGION=
VUE_APP_AWS_BUCKET_NAME=
VUE_APP_AWS_BUCKET_URL=
VUE_APP_AWS_BUCKET_KEY=
VUE_APP_AWS_ROLE_ARN=
VUE_APP_FIREBASE_API_KEY=
VUE_APP_FIREBASE_AUTH_DOMAIN=
VUE_APP_FIREBASE_DATABASE_URL=
VUE_APP_FIREBASE_PROJECT_ID=
VUE_APP_FIREBASE_STORAGE_BUCKET=
VUE_APP_FIREBASE_MESSAGING_SENDER_ID=
VUE_APP_FIREBASE_APP_ID=
VUE_APP_FIREBASE_MEASUREMENT_ID=
```

Configure a ```.env``` file for root folder (server):
```
PORT=
```

* ```PORT```
> The port whereas express serve will run.

* ```VUE_APP_NODE_ENV```
> Can be ```production```, ```development``` or ```test``` (not implemented).

* ```VUE_APP_BASE_URL```
> Should be frontend domain. Used to set PWA.

* ```VUE_APP_API_URL_[ENVIROMENT]```
> There are differents ```API_URL``` variables so can be easily changed on ```utils.js``` without the need to restart the project.

* ```VUE_APP_TENANT```
> Should be the ```tenant_id``` on database. <br><br>
> *This variable can be removed by modifing the ```auth/token``` api request to send a ```tenant_id``` and then saved this on local storage.* <br><br>
> *By doing this, it will be possible to deploy only 1 frontend (instead of build it everytime for each tenant).*

* ```VUE_APP_VERSION```
> Should be the app version. <br> 
> Ex: ```2.5```

* ```VUE_APP_DEFAULT_LOCALE```
> Currently only supports ```en``` or ```pt```.

* ```VUE_APP_FIREBASE_[VAR]```
> Should be the firebase config credentials. <br>
> Loads on ```main.js```

* ```VUE_APP_AWS_[VAR]``` 
> Should be AWS credentials. <br><br>
> *```VUE_APP_AWS_ROLE_ARN``` and ```VUE_APP_AWS_IDENTITY_POOL_ID``` is used only for upload images in ```editable``` layers.* <br><br>
> *```VUE_APP_AWS_BUCKET``` should have a folder called ```media``` where the images should be uploaded* <br><br>
> <sub><sup>__*images on media folder should be named on uppercase*__</sub></sup>


Once the ```.env``` file is configured, run:

```
yarn dev
```

## Deploy

1. For ```S3 AWS``` deploy:

````
yarn deploy:dev 

#or

yarn deploy:prod
````

* Make sure that you have the bucket and its policys created;
* ```aws cli``` is necessary to deploy on S3. <br><br>
<sub><sup>*Refer to ```scripts``` on ```package.json``` to check bucket name*</sub></sup>

2. For ```Docker``` deploy:

````
docker build -t crimeradar:0.0.1 --no-cache .
````
````
docker run -p 8080:3000 -t crimeradar:0.0.1
````

* ```docker cli``` is necessary to run a docker.

## Configuration (outdated)

To first configure an user and the map options, will be necessary to access ```/config``` page. An username and password are required to move forward. 
>The credentias can be generated by running ```yarn account```.

By running the command an ```account.txt``` file will be generated under ```app``` folder, whereas the __*first line is the username and the second one is a password*__.

<sub><sup>*If preferable, there is no urge to run the command, a simple ```account.txt``` file with custom credentials can be manually created and placed under ```app``` folder.*</sub></sup>

> If there is not an ```account.txt``` file, it will be not possible to login on ```/config``` (API will throw 500 error). So after make the configurations, the best practice is to delete this file.

**UPDATED**: The first user configuration now is generated by backend `FIREBASE_ADMIN` envs. Make sure to remove the `account.txt` file to make `/config` route not accessible.

## Common Issues

* If using AWS S3, make sure to configure ir properly - it will reduce a lot of time debugging the application later on.
* If using AWS S3, make sure to redirect traffic to ```/``` on errors pages (403 and 404) in CloudFront.
* If using AWS S3, make sure to redirect to ```index.html``` on error page, so users do not see the forbidden page when accessing url directly.



